<?xml version="1.0" encoding="UTF-8"?>
<!-- NOTE THAT WE *MUST* DECLARE THE xmlns ATTRIBUTE -->
<ccxml version="1.0" xmlns:voxeo="http://community.voxeo.com/xmlns/ccxml">


  <eventprocessor>
    <transition event="connection.alerting">

    <log expr="'*** The calledID is ' + event$.connection.local"/>
    <log expr="'*** The caller ID is ' + event$.connection.remote"/>

     <accept/>	

    </transition>

    <transition event="connection.connected">
      <log expr="'*** Call was accepted ***'"/>
      <dialogstart 		
		src="'null://?termdigits=*#&amp;voice=English-Male2&amp;text=We are Sorry you have to leave us. Please enter your phone number followed by the pound sign to opt out'"
		type="'application/x-fetchdigits'"
		/>
    </transition>

    <transition event="connection.disconnected">
      <log expr="'*** Call was disconnected ***'"/>
      <exit/>
    </transition>


    <transition event="connection.failed">
      <voxeo:sendemail to="'exceptions@rishistar.com'"
                        from="'rishi@sixteen30.com'"
                        type="'debug'"
                        body="'Error in callout app \n '"/>
      <exit/>
    </transition>
    
     <transition event="dialog.exit">
    	<log expr="'**** USER PRESSED: ' + event$.values.digits" />
  	<log expr="'**** TERMCHAR PRESSED: ' + event$.values.termdigit" />
      	
  	<if cond="event$.values.termdigit == '#'">
  		<log expr="'**** TRYING TO SEND TO http://sixteen30.net/MessageDeliverySystem/OptOut?project=ODWB&amp;number_full=' + event$.values.digits"/>
  		<send 
	  		name="'http.get'" 
	  		target="'http://sixteen30.net/MessageDeliverySystem/OptOut?project=ODWB&amp;number_full=' + event$.values.digits"
	  		targettype="'basichttp'"
  		/> 
  		<dialogstart 
  			src="'null://?text=Your number has now been opted out from our system. Goodbye.'" 
  			type="'audio/wav'"/>
  		<log expr="'**** OPTOUT SENT"/>  	  		
  	</if>
  	  	
  	
    </transition>

  </eventprocessor>

  <log expr="'*** Application is starting ***'"/>

</ccxml>
